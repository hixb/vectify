<script lang="ts">
  import { onMount } from 'svelte'
  import type { IconNode } from 'vectify'

  export let iconNode: IconNode[]
  export let size: number | string = 24
  export let color: string = 'currentColor'
  export let strokeWidth: number | string = 2
  export let className: string = ''
  export let title: string = ''
  export let ariaLabel: string = ''
  export let ariaHidden: boolean | 'true' | 'false' | undefined = undefined

  let svgElement: SVGSVGElement

  // Merge className with default class
  $: mergedClass = className ? `vectify-icon ${className}` : 'vectify-icon'

  // Determine if icon should be hidden from screen readers
  $: shouldHide = ariaHidden !== undefined ? ariaHidden : (!title && !ariaLabel)

  function renderNode(node: IconNode): SVGElement {
    const [type, attrs, children] = node
    const element = document.createElementNS('http://www.w3.org/2000/svg', type)

    // Set attributes
    Object.entries(attrs).forEach(([key, value]) => {
      element.setAttribute(key, String(value))
    })

    // Render children
    if (children && children.length > 0) {
      children.forEach(child => {
        element.appendChild(renderNode(child))
      })
    }

    return element
  }

  onMount(() => {
    // Clear existing content (except title if present)
    while (svgElement.firstChild) {
      if (svgElement.firstChild.nodeName !== 'title') {
        svgElement.removeChild(svgElement.firstChild)
      } else {
        break
      }
    }

    // Render icon nodes after title
    iconNode.forEach(node => {
      svgElement.appendChild(renderNode(node))
    })
  })
</script>

<svg
  bind:this={svgElement}
  width={size}
  height={size}
  viewBox="0 0 24 24"
  fill="none"
  stroke={color}
  stroke-width={strokeWidth}
  stroke-linecap="round"
  stroke-linejoin="round"
  class={mergedClass}
  aria-hidden={shouldHide}
  aria-label={ariaLabel || undefined}
  role={title || ariaLabel ? 'img' : undefined}
  {...$$restProps}
>
  {#if title}
    <title>{title}</title>
  {/if}
</svg>
